<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Member Dashboard | Lab Fitness</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
tailwind.config = { darkMode: 'class' }
</script>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

<div class="flex min-h-screen">

<!-- SIDEBAR -->
<aside id="sidebar"
class="w-64 bg-black text-white flex-col p-6 h-screen sticky top-0 hidden md:flex transition-all">

<h1 class="text-xl font-bold mb-8">Lab Fitness</h1>

<nav class="space-y-2 text-sm">
<a class="block px-4 py-2 rounded bg-gray-800">Dashboard</a>
<a href="profile.html" class="block px-4 py-2 rounded hover:bg-gray-800">Profile</a>
<a href="program.html" class="block px-4 py-2 rounded hover:bg-gray-800">Program</a>
<a href="contact.html" class="block px-4 py-2 rounded hover:bg-gray-800">Contact</a>
</nav>

<div class="mt-auto space-y-4">
<button onclick="toggleDark()" class="text-sm text-gray-400 hover:text-white">ðŸŒ™ Dark / Light</button>
<button onclick="exportPDF()" class="text-sm text-green-400 hover:text-green-300">â¬‡ Export PDF</button>
<button onclick="logout()" class="text-sm text-red-400 hover:text-red-300">Logout</button>
</div>
</aside>

<!-- MOBILE TOPBAR -->
<header class="md:hidden bg-black text-white p-4 flex justify-between">
<span class="font-bold">Lab Fitness</span>
<button onclick="toggleMenu()">â˜°</button>
</header>

<!-- CONTENT -->
<main class="flex-1 p-4 md:p-6">

<!-- SKELETON -->
<div id="skeleton" class="animate-pulse space-y-4">
<div class="h-24 bg-gray-300 rounded"></div>
<div class="h-32 bg-gray-300 rounded"></div>
<div class="h-40 bg-gray-300 rounded"></div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden md:grid grid-cols-3 gap-6">

<!-- LEFT -->
<div class="col-span-2 space-y-6">

<section class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow flex gap-5">
<img id="photo" class="w-24 h-24 rounded-full border" src="https://via.placeholder.com/100">
<div>
<h2 id="name" class="text-2xl font-bold">-</h2>
<p id="status" class="text-sm text-gray-400">-</p>
<p id="badge" class="text-sm font-semibold">-</p>
</div>
</section>

<section class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow">
<h3 class="font-bold mb-2">Program Latihan</h3>
<p id="program">-</p>
<p id="programDate" class="text-xs text-gray-400 mt-2"></p>
</section>

<section class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow">
<h3 class="font-bold mb-4">Kehadiran 30 Hari</h3>
<canvas id="attendanceChart"></canvas>
</section>

</div>

<!-- RIGHT -->
<div class="space-y-4">
<div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
<p class="text-xs text-gray-400">Kode</p>
<p id="code" class="font-semibold"></p>
</div>
<div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
<p class="text-xs text-gray-400">Sisa Hari</p>
<p id="days" class="font-semibold"></p>
</div>
<div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
<p class="text-xs text-gray-400">Membership</p>
<p id="level" class="font-semibold"></p>
</div>
<div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
<p class="text-xs text-gray-400">Total Hadir</p>
<p id="attendance" class="font-semibold"></p>
</div>
</div>

</div>
</main>
</div>

<script src="assets/js/member.js"></script>

<script>
/* ================= UI ================= */
function toggleMenu(){ sidebar.classList.toggle("hidden") }
function toggleDark(){ document.documentElement.classList.toggle("dark") }

/* ================= AFTER API LOAD ================= */
const originalRender = window.renderMember;
window.renderMember = function(data){
originalRender(data);

document.getElementById("skeleton").classList.add("hidden");
document.getElementById("dashboard").classList.remove("hidden");

/* REAL CHART */
const hadir = Number(data.attendance_30d || 0);
const absen = 30 - hadir;

new Chart(document.getElementById("attendanceChart"),{
type:"doughnut",
data:{
labels:["Hadir","Tidak Hadir"],
datasets:[{ data:[hadir,absen] }]
},
options:{ plugins:{ legend:{ position:"bottom" } } }
});
};

/* ================= PDF ================= */
function exportPDF(){
html2pdf().from(document.getElementById("dashboard")).save("Progress_Member.pdf");
}

/* ================= PWA ================= */
if("serviceWorker" in navigator){
navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
